<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>FreeCodeCamp - Camper Leaderboard</title>
    <script src="./bower_components/react/react.min.js" charset="utf-8"></script>
    <script src="./bower_components/react/react-dom.min.js" charset="utf-8"></script>
    <script src="./bower_components/babel-browser/browser.js" charset="utf-8"></script>
    <link rel="stylesheet" href="./css/style.css">
  </head>
  <body>
    <h2>Camper Leaderboard</h2>
    <div id='app'></div>
  </body>
  <script type="text/babel">

    var FetchDemo = React.createClass({
      links: {
        recent: 'https://fcctop100.herokuapp.com/api/fccusers/top/recent',
        alltime: 'https://fcctop100.herokuapp.com/api/fccusers/top/alltime'
      },
      getInitialState: function() {
        return {
          users : []
        };
      },

      componentDidMount: function() {
        var _this = this;
        var link = this.links[this.props.selection];
        this.serverRequest = fetch(new Request(link))
          .then(function(response) {
            return response.json()
              .then(function(json) {
                _this.setState({
                  users: json
                });
              });
          });
      },

      componentWillUnmount: function() {
         this.serverRequest.abort();
       },

      render: function() {
        var imgStyle = {
          width: 20,
          height: 20,
          padding: 5,
          borderRadius: 5,
          border: 'solid thin black',
          boxShadow: '3px 2px darkgray'
        };
        var userItems = this.state.users.map(function(user, idx) {
          return (
            <tr className='user'>
              <td>{idx+1}</td>
              <td>
                <img src={user.img} />
                <span className='name'>{user.username}</span>
              </td>
              <td>{user.recent}</td>
              <td>{user.alltime}</td>
            </tr>
          );
        });
        return (
          <div>
            <h1>{this.props.selection}</h1>
            <table>
             <thead>
               <tr>
                 <td>#</td>
                 <td>Camper</td>
                 <td>Points in past 30 days</td>
                 <td>All time points</td>
               </tr>
             </thead>
             <tbody>
              {userItems}
             </tbody>
            </table>
          </div>
        );
      }
    });

    ReactDOM.render(
      <FetchDemo selection="recent"/>,
      document.getElementById('app')
    );

  </script>
</html>
